<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Patrick Weaver</title>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Patrick Weaver's Website">
    <link id="favicon" rel="icon" href="/images/favicon.png" type="image/png">
    
    <!-- Social -->
      <meta property="og:title" content="How to Set Up a Raspberry Pi as a Home Webserver"/>
      <meta property="og:description" content="" />
      <meta property="og:image" content="/images/blog/how-to-raspberry-pi-server/pi-on-ipad.jpg" />
    
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@patrickweave_r" />
    <meta name="twitter:creator" content="@patrickweave_r" />
      <meta name="twitter:title" content="How to Set Up a Raspberry Pi as a Home Webserver"/>
      <meta name="twitter:description" content="" />
      <meta name="twitter:image" content="/images/blog/how-to-raspberry-pi-server/pi-on-ipad.jpg" />
      <meta name="twitter:image:alt" content="A photo of a Raspberry Pi on an iPad" />
    
    <link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <header>
      <h1 id="site-title">
        <a href="/about">Patrick Weaver</a>
      </h1>
      
      <ul id="menu">
        <li><a href="/about">About</a></li>
        <li><a href="/blog">Blog</a></li>
        <li><a href="/portfolio">Portfolio</a></li>
        <li><a href="/now">Now</a></li>
        <li><a href="/links">Links</a></li>
      </ul>
      
    </header>
    <h2>
      Blog
    </h2>
    
    <div class="post">
      
      <h3 class="post-title">
        <a href="">
            How to Set Up a Raspberry Pi as a Home Webserver
        </a>
      </h3>
      
      <div class="blog-cover">
        
        <p class="post-preview-date">
          May 3, 2021
        </p>
      
            <div class="post-header-image">
              <a href="">
                <img class="blog-cover-image" src="/images/blog/how-to-raspberry-pi-server/pi-on-ipad.jpg" alt="A photo of a Raspberry Pi on an iPad" />
              </a>
            </div>
      
      </div>      
      <p>Like most of the world, I‚Äôve been spending a lot of time at home lately. Over the winter I was experimenting with building my own web-based digital tools, like an app to track articles and books I was reading. I initially thought I would need to buy hosting space to have the app accessible, but realized I mostly needed to use it when I was at home anyway, so a URL that only existed on my local network work also work.</p>
<p>I have done a few projects with Raspberry Pis before, most notably a <a href="https://www.patrickweaver.net/blog/building-a-futuristic-record-player-with-glitch-and-raspberry-pi/">computer vision ‚Äúrecord player‚Äù</a>, but always found myself looking up the same things like how to set up Wi-Fi and SSH access. I seemed to need to do the same handful of things every time, but they were spread across various documentation and how-tos. This time while setting up the Pi webserver I took notes so I would have it all in one place.</p>
<p>To follow along with these steps you will need a second computer to set up the SD card (though you could probably start with a <a href="https://www.adafruit.com/product/4266">preformatted SD card also</a>), and any kind of Raspberry Pi. I have run webservers on Pi Zeros before, though it can be a challenge to install newer versions of Node.js on ARMv6 based Pis (Zero and the original Raspberry Pi), and sometimes when building a large client app I‚Äôve had to move to a faster Pi from a Pi Zero.</p>
<h2>SD Card Setup</h2>
<h3>1. Install the OS</h3>
<p>Raspberry Pi recently released their own tool for formatting SD cards, <a href="https://www.raspberrypi.org/software/">Raspberry Pi Imager</a>. It makes the process a lot easier than it had been previously. The first step is picking an OS to format the card with. Any of the Debian-based OSes should work, though the smallest download is Raspberry Pi OS Lite, which is all you need if you won‚Äôt be connecting a display. After that, selec the SD card you want to install onto (there will probably only be one choice), and click ‚ÄúWrite‚Äù.</p>
<blockquote>
<p><strong>1. Install the OS:</strong> Use Raspberry Pi Imager tool to write the OS to the SD card <a href="https://www.raspberrypi.org/software/">source</a></p>
</blockquote>
<p><img src="/images/blog/how-to-raspberry-pi-server/raspberry-pi-imager.png" alt="A screenshot of the Raspberry Pi Imager Tool"></p>
<h3>2. Set up Wi-Fi</h3>
<p>The RPi Imager tool will likely eject the SD card for you when it‚Äôs finished writing, but you want to do two more things before booting up the Pi. You may need to remove the SD card and re-insert it into your computer to see the ‚ÄúBoot‚Äù filesystem. First, to enable Wi-Fi you will need to create a file with your network credentials. If you will be plugging the Pi into an eithernet cord you can skip this step.</p>
<p>Create a file called <code>wpa_supplicant.conf</code> in the root directory of the SD card. Open the file in a text editor and paste in the following:</p>
<pre><code class="language-conf">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=&lt;2 LETTER ISO 3166-1 COUNTRY CODE&gt;

network={
    ssid=&quot;&lt;WI-FI SSID&gt;&quot;
    psk=&quot;&lt;WI-FI PASSWORD&gt;&quot;
}
</code></pre>
<p>Update the <code>country</code> line with your <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">ISO 3166 country code</a> (for the United States this will be <code>US</code> without quotes). Update the <code>ssid</code> and <code>psk</code> lines of the <code>network</code> section to your Wi-Fi network SSID and password, with quotes. Read more about setting up Wi-Fi <a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">here</a>.</p>
<p>My <code>wpa_supplicant.conf</code> might look like this:</p>
<pre><code class="language-conf">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

network={
    ssid=&quot;patricknet&quot;
    psk=&quot;myverysecurepassword&quot;
}
</code></pre>
<h4>Note on Text Encoding</h4>
<blockquote>
<p><a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">Setting up a Raspberry Pi headless</a>: ‚ÄúDepending on the OS and editor you are creating this on, the file could have incorrect newlines or the wrong file extension so make sure you use an editor that accounts for this. Linux expects the line feed (LF) newline character.‚Äù</p>
</blockquote>
<blockquote>
<p>Learn More: <a href="https://www.youtube.com/watch?v=TtiBhktB4Qg">Scott Hanselman on CR/LF</a></p>
</blockquote>
<blockquote>
<p><strong>2. Set up Wi-Fi:</strong> Create a <code>wpa_supplicant.conf</code> file in the root directory of the SD card, and populate it with your Wi-Fi credentials to enable Wi-Fi on boot. <a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">source</a></p>
</blockquote>
<h3>3. Set up SSH</h3>
<p>By default SSH access is disabled on a Raspberry Pi, the usual way of enabling it is either through the GUI or <code>raspi-config</code>, but there is also a simple way to pre-setup on the SD card. Create an empty file called <code>ssh</code> (without a file extension) in the root directory of the SD card, this will enable SSH on boot.</p>
<blockquote>
<p><strong>3. Set up SSH:</strong> Create an empty <code>ssh</code> file in the root directory of the SD card to enable SSH access on boot. <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/README.md">source</a></p>
</blockquote>
<h2>Raspberry Pi Setup</h2>
<p>You are now ready to boot the Raspberry Pi, insert the SD card and power up the Pi. After a minute or two of boot time it should automatically connect to your network.</p>
<h3>4. Connect via SSH</h3>
<p>In a terminal on a second computer and connect to the Raspberry Pi via SSH. The default username and password will be <code>pi</code> and <code>raspberry</code>, and the default hostname will be <code>raspberrypi</code>. If your local network supports the <code>.local</code> TLD you may be able to connect using:</p>
<pre><code class="language-bash">ssh pi@raspberrypi.local
</code></pre>
<p>Otherwise you will need to look up the IP address of the Pi in your network admin tools and connect using the IP address:</p>
<pre><code class="language-bash">ssh pi@192.168.XXX.XXX
</code></pre>
<p>You can also skip this step and open the Terminal app on the Pi if using a display and keyboard connected to the Pi.</p>
<p>If you have previously connected via SSH to a Raspberry Pi with the default hostname on the computer you are using you may see a message about the remote host identification changing. To successfully connect via SSH you will need to update the <code>known_hosts</code> file to remove the key stored for the other Raspberry Pi.</p>
<p>On Linux or macOS the <code>known_hosts</code> file will be at <code>/Users/[YOUR USERNAME]/.ssh/known_hosts</code>. Find the line in this file that starts with either <code>raspberrypi.local</code> or the Raspberry Pi‚Äôs IP address and remove it.</p>
<blockquote>
<p><strong>4. Connect via SSH:</strong> Connect to the Raspberry Pi via ssh: <code>ssh pi@raspberrypi.local</code> or <code>ssh pi@192.168.XXX.XXX</code> (and enter the default password <code>raspberry</code>). You may need to remove a previous <code>raspberrypi.local</code> from <code>/Users/USERNAME/.ssh/known_hosts</code>.</p>
</blockquote>
<h3>5. Change the Password</h3>
<p>After connecting to the Raspberry Pi via SSH the login message will suggest that you change the default password:</p>
<blockquote>
<p><code>SSH is enabled and the default password for the 'pi' user has not been changed.</code> &gt; <code>This is a security risk - please login as the 'pi' user and type 'passwd' to set a new password.</code></p>
</blockquote>
<p>Following the instructions you can type <code>passwd</code> which will prompt you first for your current password (<code>raspberry</code>), then for a new password twice.</p>
<blockquote>
<p><strong>5. Change the password:</strong> Run <code>passwd</code> to have the system prompt you for a new, more secure password.</p>
</blockquote>
<h3>6. Change the Hostname</h3>
<p>The default hostname of your Raspberry Pi is <code>raspberrypi</code>. You may want to change this for a few reasons. If you have more than one Raspberry Pi on your network this will let you tell them apart, and if your network supports the .local TLD you can use the hostname as the URL to your app.</p>
<p>You will need to update two files to change your hostname. First open <code>/etc/hostname</code> and change the first and only line in the file (currently <code>raspberrypi</code>) to your new hostname. Then, open <code>/etc/hosts</code> and update the the line with <code>raspberrypi</code> to your new hostname. Finally, reboot your Pi for the changes to take effect. Remember, if you SSHed in as <code>pi@raspberrypi.local</code> you will need to use the new hostname instead.</p>
<blockquote>
<p><strong>6. Change the Hostname:</strong> Open <code>sudo nano /etc/hostname</code> and change <code>raspberrypi</code> to your new hostname, then <code>sudo nano /etc/hosts</code> and change <code>raspberrypi</code> to your new hostname. Then reboot, <code>sudo reboot now</code>. <a href="https://pimylifeup.com/raspberry-pi-hostname/">source</a></p>
</blockquote>
<h3>7. Change the Prompt</h3>
<p>I also like the change the default bash prompt whenever I am going to be SSHing into a remote computer so that I can tell the difference at a glance between a local and remote terminal window.</p>
<p>A simple change is just to prepend an emoji to the default prompt, which you can do by adding a line to <code>~/.bashrc</code>:</p>
<pre><code class="language-bash">echo 'PS1=&quot;ü•ß ${PS1}&quot;' &gt;&gt; ~/.bashrc
</code></pre>
<p>I like the following prompt which adds colors that are different than the ones that I use locally, and a pie emoji:</p>
<div class="fake-code">
<span style="color: white; background-color: silver;">&nbsp;Mon May &nbsp;03 23:41:09&nbsp;</span><br/>
<span style="color: black; background-color: cyan;">&nbsp;pi@b:&nbsp;</span> <span style="color: white; background-color: lightGrey;">&nbsp;~&nbsp;</span><br/>
ü•ß $<br/>
</div>
<p>Update your prompt by editing your <code>~/.bashrc</code> file with <code>sudo nano ~/.bashrc</code>. The bash prompt is set with the <code>PS1</code> variable, which has two versions in the default Raspberry Pi <code>~/.bashrc</code>, one for when <code>color_prompt</code> is set to <code>yes</code>, another for otherwise. The default in Raspberry Pi OS is that <code>color_prompt</code> is set to yes, so feel free to overwrite only the first <code>PS1</code> variable.</p>
<p>The value to set the prompt I showed above is (the sections with <code>[\033 ...</code> and <code>\[$(tput...</code> control turning on and off the colors):</p>
<pre><code>PS1=&quot;\n\[\033[48;5;7m\] \d \t \[$(tput sgr0)\]\n\[$(tput bold)\]\[\033[38;5;0m\]\[\033[48;5;14m\] \u@\H: \[$(tput sgr0)\] \[\033[38;5;0m\]\[\033[48;5;15m\] \w \[$(tput sgr0)\]\n ü•ß \\$ &quot;
</code></pre>
<p>Run <code>source ~/.bashrc</code> (or <code>. ~/.bashrc</code>) to reload your terminal and see your new prompt.</p>
<blockquote>
<p><strong>7. Change the Prompt:</strong> Update the <code>PS1</code> variable in <code>~/.bashrc</code> to make it look different. Add a pie emoji with <code>echo 'PS1=&quot;ü•ß ${PS1}&quot;' &gt;&gt; ~/.bashrc</code>.</p>
</blockquote>
<h3>Install Git</h3>
<p>You will probably want to use Git to manage the source code for your app. It is not installed by default on Raspberry Pi OS so you will need to install it now with <code>apt</code>:</p>
<pre><code class="language-bash">sudo apt install git
</code></pre>
<p>Note: You may have to update by running <code>sudo apt-get update</code> in order for Git to install.</p>
<p>You may also want to install another text editor if you want something more customizable than nano.</p>
<blockquote>
<p><strong>8. Install Git:</strong> Install git to manage your source code with <code>sudo apt install git</code>.</p>
</blockquote>
<h2>9. Install Nginx</h2>
<p>You can now run a webserver (with <code>sudo</code>) on port 80 and have it be available at your IP address or <code>[YOUR_HOSTNAME].local</code>, but that might require more configuration. It will be easier to manage your app if you install a webserver/reverse proxy like Nginx. You can install Nginx with <code>apt</code>:</p>
<pre><code class="language-bash">sudo apt install nginx
</code></pre>
<p>Once Nginx is installed you should be able to access the default Nginx webpage at your Rapsberry Pi‚Äôs IP Address or <code>[YOUR_HOSTNAME].local</code>. Make sure to type in the <code>http://</code> the first time if you are using the <code>.local</code> TLD to avoid triggering search in your browser.</p>
<p><img src="/images/blog/how-to-raspberry-pi-server/nginx-default.png" alt="A screenshot of the default Nginx page"></p>
<p>You can now serve any static website from <code>/var/www/html</code>, if you look there you will see an <code>index.html</code> or <code>index.nginx-debian.html</code> file that is generating the current page.</p>
<blockquote>
<p><strong>9. Install Nginx:</strong> Install with <code>apt install nginx</code>, then put a static webpage in <code>/var/www/html</code>.</p>
</blockquote>
<h2>10. Install nvm and npm</h2>
<p>I make most of my web apps these days in JavaScript, there are lots of ways to install node and npm, but one easy way to manage versions is with nvm, which can be installed with the script below:</p>
<pre><code class="language-bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
</code></pre>
<p>Then reload your terminal with <code>. ~/.bashrc</code> and install the current LTS version of node with <code>nvm install lts</code>.</p>
<p><strong>Note:</strong> On an original Raspberry Pi, or a Raspberry Pi Zero, the ARMv6 chip is no longer supported by current versions of node. ‚ÄúUnofficial‚Äù ARMv6 builds of node are available at: <a href="https://unofficial-builds.nodejs.org/">unofficial-builds.nodejs.org</a>. To install a version using an unofficial build use:</p>
<pre><code class="language-bash">NVM_NODEJS_ORG_MIRROR=https://unofficial-builds.nodejs.org/download/release nvm install lts
</code></pre>
<blockquote>
<p><strong>10. Install nvm and npm:</strong> <code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash</code>, <code>. ~/.bashrc</code>, <code>nvm install lts</code>.</p>
</blockquote>
<h2>11. Set Up Reverse Proxy</h2>
<p>In order to access your app on your local network without a port number in the URL it will need to be accessible on port 80, but it will be eaiser to run your app on another port locally. This can be done with an Nginx reverse proxy.</p>
<p>Nginx cofiguration is done via server block files, you can delete the default enabled server block by running:</p>
<pre><code class="language-bash">sudo rm /etc/nginx/sites-enabled/default
</code></pre>
<p>Next, make your own empty server block in the <code>sites-available</code> directory: . The <code>[YOUR SITE]</code> part of the path can be anything, but it makes sense to give it the name of your app.</p>
<pre><code class="language-bash">sudo touch /etc/nginx/sites-available/[YOUR SITE].conf
</code></pre>
<p>You can now edit your server block file:</p>
<pre><code class="language-bash">sudo nano /etc/nginx/sites-available/[YOUR SITE].conf
</code></pre>
<p>The server block below will proxy processes running on port 8080 to port 80 (but you can substitute any port on the <code>proxy_pass</code> line). Make sure to replace the <code>[HOSTNAME]</code> sections with your Raspberry Pi‚Äôs hostname (or omit this line if accessing via IP Address):</p>
<pre><code class="language-conf">server {
    listen 80;
    server_name www.[HOSTNAME].local [HOSTNAME].local;

    location / {
       proxy_pass http://127.0.0.1:8080;
    }
}
</code></pre>
<p>Then, link your Nginx config file to the <code>sites-enabled</code> directory:</p>
<pre><code>sudo ln -s /etc/nginx/sites-available/[YOUR-SITE].conf /etc/nginx/sites-enabled/[YOUR-SITE].conf
</code></pre>
<p>Test your Nginx config with <code>sudo nginx -t</code>. You should see a success confirmation message:</p>
<pre><code>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre>
<p>To enable the configuration reload the Nginx config:</p>
<pre><code>sudo systemctl reload nginx
</code></pre>
<p>The last step is cloning your project to the Raspberry Pi and running it on port 8080, your app should now be available at <code>[HOSTNAME].local</code>!</p>
<blockquote>
<p><strong>11. Set Up Reverse Proxy:</strong> Remove default: <code>sudo rm /etc/nginx/sites-enabled/default</code>, Create config file: <code>sudo touch /etc/nginx/sites-available/[YOUR SITE].conf</code>, Edit config file (see above): <code>sudo nano /etc/nginx/sites-available/[YOUR SITE].conf</code>, Link to sites-enabled: <code>sudo ln -s /etc/nginx/sites-available/[YOUR-SITE].conf /etc/nginx/sites-enabled/[YOUR-SITE].conf</code>, Reload Nginx: <code>sudo systemctl reload nginx</code>. <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-debian-10">source</a></p>
</blockquote>
<p><img src="/images/blog/how-to-raspberry-pi-server/hello-world.png" alt="A screenshot of a ‚ÄúHello, World‚Äù page hosted on a Raspberry Pi"></p>
<hr>
<h2>All Steps:</h2>
<ol>
<li><strong>Install the OS:</strong> Use Raspberry Pi Imager tool to write the OS to the SD card <a href="https://www.raspberrypi.org/software/">source</a></li>
<li><strong>Set up Wi-Fi:</strong> Create a <code>wpa_supplicant.conf</code> file in the root directory of the SD card, and populate it with your Wi-Fi credentials to enable Wi-Fi on boot. <a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">source</a></li>
<li><strong>Set up SSH:</strong> Create an empty <code>ssh</code> file in the root directory of the SD card to enable SSH access on boot. <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/README.md">source</a></li>
<li><strong>Connect via SSH:</strong> Connect to the Raspberry Pi via ssh: <code>ssh pi@raspberrypi.local</code> or <code>ssh pi@192.168.XXX.XXX</code> (and enter the default password <code>raspberry</code>). You may need to remove a previous <code>raspberrypi.local</code> from <code>/Users/USERNAME/.ssh/known_hosts</code>.</li>
<li><strong>Change the password:</strong> Run <code>passwd</code> to have the system prompt you for a new, more secure password.</li>
<li><strong>Change the Hostname:</strong> Open <code>sudo nano /etc/hostname</code> and change <code>raspberrypi</code> to your new hostname, then <code>sudo nano /etc/hosts</code> and change <code>raspberrypi</code> to your new hostname. Then reboot, <code>sudo reboot now</code>. <a href="https://pimylifeup.com/raspberry-pi-hostname/">source</a></li>
<li><strong>Change the Prompt:</strong> Update the <code>PS1</code> variable in <code>~/.bashrc</code> to make it look different. Add a pie emoji with <code>echo 'PS1=&quot;ü•ß ${PS1}&quot;' &gt;&gt; ~/.bashrc</code>.</li>
<li><strong>Install Git:</strong> Install git to manage your source code with <code>sudo apt install git</code>.</li>
<li><strong>Install Nginx:</strong> Install with <code>apt install nginx</code>, then put a static webpage in <code>/var/www/html</code>.</li>
<li><strong>Install nvm and npm:</strong> <code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash</code>, <code>. ~/.bashrc</code>, <code>nvm install lts</code>.</li>
<li><strong>Set Up Reverse Proxy:</strong> Remove default: <code>sudo rm /etc/nginx/sites-enabled/default</code>, Create config file: <code>sudo touch /etc/nginx/sites-available/[YOUR SITE].conf</code>, Edit config file (see above): <code>sudo nano /etc/nginx/sites-available/[YOUR SITE].conf</code>, Link to sites-enabled: <code>sudo ln -s /etc/nginx/sites-available/[YOUR-SITE].conf /etc/nginx/sites-enabled/[YOUR-SITE].conf</code>, Reload Nginx: <code>sudo systemctl reload nginx</code>. <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-debian-10">source</a></li>
</ol>

    </div>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-9178162-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-9178162-8');
    </script>
  </body>
</html>